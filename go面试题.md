# Go常见面试题

## Web框架面试题

实际上，面整体 Web 框架的还是比较少的。大多数时候，**面试都是聊具体的某个 Web 框架**。

从整体上来面的话，比较高频率的问题：

- **Web 框架拿来做什么？**

  处理 HTTP 请求，为用户提供便捷 API，为用户提供无侵入式的插件机制，提供如上传下载等默认功能

- **为什么都已经有了 http 包，还要开发 Web 框架？**

  高级路由功能、封装 HTTP 上下文以提供简单 API、封装 Server 以提供生命周期控制、设计插件机制以提供无侵入式解决方案

-  **Web 框架的核心？**

  路由树、上下文 Context、Server（按照我理解的重要性排序）



### 面试要点

- **HTTP 服务器的生命周期？**

  一般来说就是启动、运行和关闭。在这三个阶段的前后都可以插入生命周期回调。一般来说，面试生命周期，多半都是为了问生命周期回调。例如说怎么

做 Web 服务的服务发现？就是利用生命周期回调的启动后回调，将 Web 服务注册到服务中心。

- **HTTP Server 功能？**

  记住在不同的框架里面有不同的叫法，比如说在 Gin 里面叫做Engine，它们的基本功能都是提供路由注册，生命周期控制以及作为与 http 包结合的桥梁。



### 路由树总结

- ### 注册路由的注意事项

  **已经注册了的路由，无法被覆盖，例如 /user/home 注册两次，会冲突**

  - path 必须以 / 开始并且结尾不能有 /，中间也不允许有连续的 /

  - 不能在同一个位置注册不同的参数路由，例如 /user/:id 和/user/:name 冲突

  - 不能在同一个位置同时注册通配符路由和参数路由，例如 /user/:id和 /user/* 冲突

  - 同名路径参数，在路由匹配的时候，值会被覆盖，例如**`/user/:id/abc/:id`**，那么 **`/user/123/abc/456`** 最终 id = 456把这个放在 `addRoute` 方法上，那么但凡用户发现 panic 的时候看一眼这个注释，都知道出了什么问题。
  - 最后一条是可以考虑在注册路由的时候强制 panic 的



## Context 总结

- #### Context 是线程安全的吗？

  显然不是，和路由树不是线程安全的理由不太一样。

  Context 不需要保证线程安全，是因为在我们的预期里面，这个 Context 只会被用户在一个方法里面使用，而且不应该被多个 goroutine 操作。

  对于绝大多数人来说，他们不需要一个线程安全的 Context。即便真要线程安全，我们也可以提供一个装饰器，让用户在使用前手动创建装饰器来转换一下。
  
  ```go
  type SafeContext struct {
  	Context
  	mutex sync.RWMutex
  }
  
  func (c *SafeContext) RespJsonOk(val any) error {
  	c.mutex.Lock()
  	defer c.mutex.Unlock()
  	return c.RespJson(http.StatusOK,val)
  }
  ```
  
- #### Context 为什么不设计为接口？

  目前来看，看不出来设计为接口的必要性。

  Echo 设计为接口，但是只有一个实现，就足以说明设计为接口有点过度设计的感觉。即便 Iris 设计为接口，而且允许用户提供自定义实现，**但是看起来也不是那么有用**



- #### Context 能不能用泛型？

  我们已经在好几个地方用过泛型了，在 Context 里面，似乎也有使用泛型的场景，例如说处理表单数据、查询参数、路径参数……

  **答案是不能。因为 Go 泛型有一个限制，结构体本身可以是泛型的，但是它不能声明泛型方法。**

  同样的道理，**`StringValue`** 也不能声明为泛型

  



### 面試要点

- ##### 能不能重复读取 HTTP 协议的 Body 内容？

  原生 API 是不可以的。但是我们可以通过封装来允许重复读取，核心步骤是**我们将 Body 读取出来之后放到一个地方，后续都从这个地方读取**。

- ##### 能不能修改 HTTP 协议的响应？

  原生 API 也是不可以的。但是可以用我们的 `RespData` 这种机制，在最后再把数据刷新到网络中，在刷新之前，都可以修改。

- ##### Form 和 `PostForm` 的区别。

  课程上讲过，一个无聊的问题，正常的情况下你的 API 优先使用 Form就不太可能出错。

- ##### Web 框架是怎么支持路径参数的？

  简单得很，Web 框架在发现匹配上了某个路径参数之后，将这段路径记录下来作为路径参数的值，这个值默认是 string 类型，用户自己有需要就可以转化为不同的类型。



## AOP方案

- **什么是 AOP ？**

   AOP 就是面向切面编程，用于解决横向关注点问题，如可观测性问题、安全问题等。

- **什么是洋葱模式？**

  形如洋葱，拥有一个核心，这个核心一般就是业务逻辑。而后在这个核心外面层层包裹，每一层就是一个 Middleware。一般用洋葱模式来**无侵入式地增强核心功能**，或者解决 AOP 问题。

- **什么是责任链模式？**

  不同的 Handler 组成一条链，链条上的每一环都有自己功能。一方面可以用责任链模式将复杂逻辑分成链条上的不同步骤，另外一方面也可以灵活地在链条上添加新的 Handler。

- **怎么实现？**

  最简单的方案就是我们课程上讲的这种函数式方案，还有一种是集中调度的模式。

 



## GRPC

- **什么是 RPC ？**

  远程过程调用。类似的还有 RMI，远程方法调用

- **和使用 HTTP 接口比起来，使用 RPC 有什么优势？**

  不必关心 HTTP 调用的细节，对于使用者来说就如同本地调用一般

- **RPC 框架的要点是什么？**

  客户端捕捉调用信息，编码成二进制，发送到服务端。服务端查找本地服务，执行调用，写回响应。任何一个 RPC 框架都类似。所以如果面试官问 gRPC 的大概步骤，也可以这么回答

- **RPC 框架怎么捕捉本地调用信息（或者说RPC框架怎么知道你调用的是什么）？**

  主要依赖于代理模式和代码生成技术

- **什么是代理模式？什么是动态代理模式？**

  动态代理可以看做是动态生成的代理，一般是指运行时生成的代理

- **动态代理技术能用来做什么？**

  四个字，为所欲为。在这里就是用来发起 RPC 调用，然后再返回响应
